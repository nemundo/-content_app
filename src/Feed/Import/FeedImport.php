<?phpnamespace Nemundo\Content\App\Feed\Import;use Nemundo\Content\App\Feed\Content\Article\ArticleItem;use Nemundo\Content\App\Feed\Content\Feed\FeedType;use Nemundo\Content\App\Feed\Data\Article\Article;use Nemundo\Content\App\Feed\Data\Article\ArticleCount;use Nemundo\Content\App\Feed\Data\Feed\Feed;use Nemundo\Content\App\Feed\Data\Feed\FeedId;use Nemundo\Content\App\Feed\Data\Feed\FeedReader;use Nemundo\Content\Builder\IndexBuilder;use Nemundo\Core\Base\AbstractBase;use Nemundo\Core\Debug\Debug;use Nemundo\Core\Type\Text\Text;use Nemundo\Rss\Reader\RssReader;class FeedImport extends AbstractBase{    public function importFeed($feedUrl)    {        $feedUrl = (new Text($feedUrl))->trim()->getValue();        if ($feedUrl !== '') {            $rssReader = new RssReader();            $rssReader->feedUrl = $feedUrl;            //(new Debug())->write($rssReader->getTitle());            $data = new Feed();            //$data->ignoreIfExists = true;            $data->updateOnDuplicate = true;            $data->feedUrl = $feedUrl;            $data->title = $rssReader->getTitle();            $data->description = $rssReader->getDescription();            //$data->feedImage->fromUrl($rssReader->getImageUrl());            $data->save();            $id = new FeedId();            $id->filter->andEqual($id->model->feedUrl, $feedUrl);            $feedId = $id->getId();            $feedType = new \Nemundo\Content\App\Feed\Content\Feed\FeedItem($feedId);            (new IndexBuilder())->buildIndex($feedType);            /*            $feedType = new FeedContentType();            $feedType->feedTitle = $rssReader->getTitle();            $feedType->description = $rssReader->getDescription();            $feedType->feedUrl = $feedUrl;            $feedType->saveType();*/            foreach ($rssReader->getData() as $rssItem) {                $count = new ArticleCount();                $count->filter->andEqual($count->model->url, $rssItem->url);                if ($count->getCount() == 0) {                    $data = new Article();                    $data->feedId = $feedId;                    $data->title = $rssItem->title;                    $data->description = $rssItem->description;                    $data->url = $rssItem->url;                    $data->dateTime = $rssItem->dateTime;                    if ($rssItem->enclosureType == 'image/jpeg') {                        $data->hasImage = true;                        $data->imageUrl =$rssItem->enclosureUrl;                    } else {                        $data->hasImage = false;                    }                    /*if ($this->audioUrl !== null) {                        $data->hasAudio = true;                        $data->audioUrl = $this->audioUrl;                    } else {                        $data->hasAudio = false;                    }*/                    $articleId = $data->save();                    $articleType = new ArticleItem($articleId);                    (new IndexBuilder())->buildIndex($articleType);                    /*                    $itemType = new FeedItemContentType();                    $itemType->feedId = $feedType->getDataId();                    $itemType->title = $rssItem->title;                    $itemType->description = $rssItem->description;                    $itemType->url = $rssItem->url;                    $itemType->feedDateTime = $rssItem->dateTime;                    if ($rssItem->enclosureType == 'image/jpeg') {                        $itemType->imageUrl = $rssItem->enclosureUrl;                    }                    if (($rssItem->enclosureType == 'audio/mp3') || ($rssItem->enclosureType == 'audio/mpeg')) {                        $itemType->audioUrl = $rssItem->enclosureUrl;                        $itemType->url = $itemType->audioUrl;                    }                    $itemType->saveType();*/                }            }        }    }    public function importFeedList()    {        $reader = new FeedReader();        foreach ($reader->getData() as $feedRow) {            $this->importFeed($feedRow->feedUrl);        }    }}